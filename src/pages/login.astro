---
import Base from '../layouts/Base.astro';
---

<Base title="تسجيل الدخول" description="Sign in">
  <h1 style="text-align:center;margin:2rem 0;">تسجيل الدخول</h1>

  <div style="display:grid;gap:1rem;place-items:center;">
    <button id="googleBtn" style="padding:.75rem 1.25rem;border-radius:.75rem;">
      المتابعة مع Google
    </button>

    <button id="signOutBtn" style="padding:.5rem 1rem;border-radius:.5rem;">
      تسجيل الخروج
    </button>

    <pre id="status" style="max-width:720px;white-space:pre-wrap;"></pre>
  </div>

  <script type="module">
    import { app, auth, GoogleProvider, onAuthStateChanged, signInWithPopup, signOut } from "../../lib/firebase.js";

    const status = document.getElementById("status");
    const googleBtn = document.getElementById("googleBtn");
    const signOutBtn = document.getElementById("signOutBtn");

    function show(msg) { status.textContent = msg; }

    onAuthStateChanged(auth, (user) => {
      if (user) {
        show("✅ Signed in as: " + (user.displayName || user.email));
      } else {
        show("❌ Not signed in");
      }
    });

    googleBtn.addEventListener("click", async () => {
      try {
        await signInWithPopup(auth, GoogleProvider);
      } catch (e) {
        show("Login error: " + (e.code || e.message));
        console.error(e);
      }
    });

    signOutBtn.addEventListener("click", async () => {
      try {
        await signOut(auth);
      } catch (e) {
        show("Sign-out error: " + (e.code || e.message));
        console.error(e);
      }
    });
  </script>
</Base>
