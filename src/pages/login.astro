---
import Base from "@/layouts/Base.astro";
const e = import.meta.env;
const SB = {
  url: e.PUBLIC_SUPABASE_URL,
  key: e.PUBLIC_SUPABASE_ANON_KEY,
};
---

<Base title="تسجيل الدخول">
  <section class="card" style="max-width:620px;margin:36px auto;padding:28px;border-radius:20px;">
    <div style="text-align:center;margin-bottom:18px;">
      <h1 style="margin:0 0 6px;font-size:clamp(22px,3vw,32px);font-weight:900;">تسجيل الدخول</h1>
      <p class="muted" style="margin:0;">سجّل دخولك أو أنشئ حسابًا بالبريد الإلكتروني.</p>
    </div>

    <div style="display:grid;gap:14px;">
      <label>البريد الإلكتروني</label>
      <input id="email" type="email" placeholder="name@email.com"
        style="padding:12px 14px;border-radius:14px;border:1px solid var(--stroke);background:rgba(255,255,255,.06);color:var(--ink);" />

      <label>كلمة المرور</label>
      <input id="password" type="password" placeholder="••••••••"
        style="padding:12px 14px;border-radius:14px;border:1px solid var(--stroke);background:rgba(255,255,255,.06);color:var(--ink);" />

      <div style="display:flex;gap:10px;justify-content:space-between;">
        <button id="emailLogin" class="btn" style="flex:1;">تسجيل الدخول</button>
        <button id="emailRegister" class="btn" style="flex:1;">إنشاء حساب</button>
      </div>

      <p id="msg" class="muted" style="min-height:1.2em;text-align:center;margin:6px 0 0;"></p>
    </div>
  </section>

  <script type="module" define:vars={{ SB }}>
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
    const supabase = createClient(SB.url, SB.key);

    const $ = (s)=>document.querySelector(s);
    const email = $("#email");
    const password = $("#password");
    const emailLogin = $("#emailLogin");
    const emailRegister = $("#emailRegister");
    const msg = $("#msg");
    const show = (t)=>{ if (msg) msg.textContent = t || ""; };

    emailLogin?.addEventListener("click", async ()=>{
      show("…");
      const { error } = await supabase.auth.signInWithPassword({
        email: email.value.trim(),
        password: password.value
      });
      if (error) { show(error.message); } else { location.href = "/"; }
    });

    emailRegister?.addEventListener("click", async ()=>{
      show("…");
      const { error } = await supabase.auth.signUp({
        email: email.value.trim(),
        password: password.value
      });
      if (error) { show(error.message); } else { show("تم إنشاء الحساب ✅ — تحقق من بريدك إن لزم"); }
    });
  </script>
</Base>
